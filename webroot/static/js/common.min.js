window.common=window.common||{init(o){function e(o){o&&Object.assign(this,o),this.reloadModel=async()=>window.common.rest.get(this.uref).then(o=>(Object.assign(this,o),this)),this.createModel=async()=>window.common.rest.post(`${window.common.env.uerpUrl}/common/auth/org`,this).then(o=>(Object.assign(this,o),this)),this.updateModel=async()=>window.common.rest.put(this.uref,this).then(o=>(Object.assign(this,o),this)),this.deleteModel=async()=>window.common.rest.delete(this.uref).then(o=>o),this.print=()=>{console.log(this)}}function t(o){o&&Object.assign(this,o),this.reloadModel=async()=>window.common.rest.get(this.uref).then(o=>(Object.assign(this,o),this)),this.createModel=async()=>window.common.rest.post(`${window.common.env.uerpUrl}/common/auth/role`,this).then(o=>(Object.assign(this,o),this)),this.updateModel=async()=>window.common.rest.put(this.uref,this).then(o=>(Object.assign(this,o),this)),this.deleteModel=async()=>window.common.rest.delete(this.uref).then(o=>o),this.print=()=>{console.log(this)}}function n(o){o&&Object.assign(this,o),this.reloadModel=async()=>window.common.rest.get(this.uref).then(o=>(Object.assign(this,o),this)),this.createModel=async()=>window.common.rest.post(`${window.common.env.uerpUrl}/common/auth/group`,this).then(o=>(Object.assign(this,o),this)),this.updateModel=async()=>window.common.rest.put(this.uref,this).then(o=>(Object.assign(this,o),this)),this.deleteModel=async()=>window.common.rest.delete(this.uref).then(o=>o),this.print=()=>{console.log(this)}}function m(o){o&&Object.assign(this,o),this.reloadModel=async()=>window.common.rest.get(this.uref).then(o=>(Object.assign(this,o),this)),this.createModel=async()=>window.common.rest.post(`${window.common.env.uerpUrl}/common/auth/account`,this).then(o=>(Object.assign(this,o),this)),this.updateModel=async()=>window.common.rest.put(this.uref,this).then(o=>(Object.assign(this,o),this)),this.deleteModel=async()=>window.common.rest.delete(this.uref).then(o=>o),this.print=()=>{console.log(this)}}if(console.log("(window.common) initialize"),window.common.env={},window.common.util={},window.common.auth={},window.common.rest={},window.common.wsock={},window.common.env.tenant="eqpls",window.common.env.domain="eqpls.com",window.common.env.endpoint="eqpls.com",window.common.env.uerpUrl="/uerp/v1",window.common.env.url=`https://${window.common.env.endpoint}`,window.common.loginServiceProviders=async()=>{},window.common.logoutServiceProviders=async()=>{},window.common.util.parseQueryToMap=o=>{let e={};return o.replace("?","").split("&").forEach(o=>{let t=o.split("=");e[t[0]]=t[1]}),e},window.common.util.getCookie=o=>{var e=document.cookie.match("(^|;) ?"+o+"=([^;]*)(;|$)");return e?e[2]:null},window.common.util.setCookie=(o,e,t)=>{t||(t=3600);var n=new Date;n.setTime(n.getTime()+1e3*t),document.cookie=o+"="+e+";expires="+n.toUTCString()+";path=/"},window.common.util.delCookie=o=>{document.cookie=o+"=; expires=Thu, 01 Jan 1999 00:00:10 GMT;"},window.common.util.setArrayFunctions=(o,e)=>(o.len=()=>o.length,o.empty=()=>0==o.len(),o.findById=e=>(o.forEach(o=>{if(e==o.id)return o}),None),o.searchByName=e=>{let t=[];return o.forEach(o=>{o.name.indexOf(e)>-1&&t.push(o)}),setArrayFunctions(t,o.obj)},o.searchByField=(e,t)=>{let n=[];return o.forEach(o=>{t==o[e]&&n.push(o)}),setArrayFunctions(n,o.obj)},o.sortAscBy=e=>{if(!o.empty()){let t=o[0][e];"string"==typeof t?o.sort((o,t)=>{let n=o[e],m=t[e];return n<m?-1:n>m?1:0}):"number"==typeof t?o.sort((o,t)=>o[e]-t[e]):console.error("could not sort",o)}return o},o.sortDescBy=e=>{if(!o.empty()){let t=o[0][e];"string"==typeof t?o.sort((o,t)=>{let n=o[e],m=t[e];return n>m?-1:n<m?1:0}):"number"==typeof t?o.sort((o,t)=>t[e]-o[e]):console.error("could not sort",o)}return o},o.print=()=>{o.empty()?console.log(`${o.obj.name}s is empty array`):console.log(`${o.obj.name}s`,o)},o.obj=e,o),window.common.auth.url=`${window.common.env.url}/auth`,window.common.setOrg=o=>(o?window.common.auth.org=o:window.common.auth.org=window.common.env.tenant,window.common.auth.org),window.common.getOrg=()=>window.common.auth.org?window.common.auth.org:window.common.setOrg(),window.common.login=e=>{let t=new Keycloak({url:window.common.auth.url,realm:window.common.getOrg(),clientId:window.common.env.tenant});t.onAuthSuccess=()=>{window.common.auth.keycloak=t,window.common.auth.postLogin=()=>(window.common.auth.accessToken=window.common.auth.keycloak.token,window.common.auth.refreshToken=window.common.auth.keycloak.refreshToken,window.common.auth.idToken=window.common.auth.keycloak.idToken,window.common.auth.bearerToken=`Bearer ${window.common.auth.accessToken}`,window.common.auth.headers={Authorization:window.common.auth.bearerToken,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},window.common.loginServiceProviders().then(window.common.auth.checkUserInfo)),window.common.auth.postLogin().then(()=>{if(window.module)for(let e in window.module)window.module[e].isAutoLogin&&window.module[e].login();window.common.auth.startTokenDaemon(),o()})},t.onAuthError=()=>{console.error("could not get authorization"),window.location.replace(e||"/")},t.init({onLoad:"login-required",redirectUri:e||"/"})},window.common.logout=async o=>{window.common.logoutServiceProviders().then(()=>{window.common.auth.keycloak.logout({redirectUri:o||"/"}).catch(o=>{console.error(o),window.location.replace("/")})}).catch(o=>{console.error(o)})},window.common.auth.checkUserInfo=async()=>fetch(`/auth/realms/${window.common.getOrg()}/protocol/openid-connect/userinfo`,{headers:window.common.auth.headers}).then(o=>{if(o.ok)return o.json();throw o}).then(o=>{window.common.auth.username=o.preferred_username,window.common.auth.userInfo=o}),window.common.auth.startTokenDaemon=()=>{window.common.auth.keycloak.updateToken(300).then(o=>{o&&window.common.auth.postLogin(),setTimeout(window.common.auth.startTokenDaemon,6e4)})},window.common.getSchema=async()=>window.common.rest.get(`${window.common.env.uerpUrl}/schema`).then(o=>o),window.common.auth.readOrg=async o=>window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/org/${o}`).then(o=>new e(o)),window.common.auth.countOrg=async o=>{if(o){let e=[];for(let t in o)e.push(`${t}=${o[t]}`);o=`?${e.join("&")}`}else o="";return window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/org/count${o}`).then(o=>o)},window.common.auth.searchOrg=async o=>{if(o){let t=[];for(let n in o)t.push(`${n}=${o[n]}`);o=`?${t.join("&")}`}else o="";return window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/org${o}`).then(o=>{let t=[];return o.forEach(o=>{t.push(new e(o))}),window.common.util.setArrayFunctions(t,e)})},window.common.auth.Org=e,window.common.auth.readRole=async o=>window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/role/${o}`).then(o=>new t(o)),window.common.auth.countRole=async o=>{if(o){let e=[];for(let t in o)e.push(`${t}=${o[t]}`);o=`?${e.join("&")}`}else o="";return window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/role/count${o}`).then(o=>o)},window.common.auth.searchRole=async o=>{if(o){let e=[];for(let n in o)e.push(`${n}=${o[n]}`);o=`?${e.join("&")}`}else o="";return window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/role${o}`).then(o=>{let e=[];return o.forEach(o=>{e.push(new t(o))}),window.common.util.setArrayFunctions(e,t)})},window.common.auth.Role=t,window.common.auth.readGroup=async o=>window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/group/${o}`).then(o=>new n(o)),window.common.auth.countGroup=async o=>{if(o){let e=[];for(let t in o)e.push(`${t}=${o[t]}`);o=`?${e.join("&")}`}else o="";return window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/group/count${o}`).then(o=>o)},window.common.auth.searchGroup=async o=>{if(o){let e=[];for(let t in o)e.push(`${t}=${o[t]}`);o=`?${e.join("&")}`}else o="";return window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/group${o}`).then(o=>{let e=[];return o.forEach(o=>{e.push(new n(o))}),window.common.util.setArrayFunctions(e,n)})},window.common.auth.Group=n,window.common.auth.readAccount=async o=>window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/account/${o}`).then(o=>new m(o)),window.common.auth.countAccount=async o=>{if(o){let e=[];for(let t in o)e.push(`${t}=${o[t]}`);o=`?${e.join("&")}`}else o="";return window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/account/count${o}`).then(o=>o)},window.common.auth.searchAccount=async o=>{if(o){let e=[];for(let t in o)e.push(`${t}=${o[t]}`);o=`?${e.join("&")}`}else o="";return window.common.rest.get(`${window.common.env.uerpUrl}/common/auth/account${o}`).then(o=>{let e=[];return o.forEach(o=>{e.push(new m(o))}),window.common.util.setArrayFunctions(e,m)})},window.common.auth.Account=m,window.common.rest.get=async o=>fetch(o,{headers:window.common.auth.headers}).then(o=>{if(o.ok)return o.json();throw o}),window.common.rest.post=async(o,e)=>fetch(o,{method:"POST",headers:window.common.auth.headers,body:JSON.stringify(e)}).then(o=>{if(o.ok)return o.json();throw o}),window.common.rest.put=async(o,e)=>fetch(o,{method:"PUT",headers:window.common.auth.headers,body:JSON.stringify(e)}).then(o=>{if(o.ok)return o.json();throw o}),window.common.rest.patch=async(o,e)=>fetch(o,{method:"PATCH",headers:window.common.auth.headers,body:JSON.stringify(e)}).then(o=>{if(o.ok)return o.json();throw o}),window.common.rest.delete=async(o,e)=>fetch(o,{method:"DELETE",headers:window.common.auth.headers,body:e||null}).then(o=>{if(o.ok)return o.json();throw o}),window.common.wsock.connect=(o,e,t,n)=>{let m=new WebSocket(`wss://${window.common.env.endpoint}${o}`);return m.sendData=async(o,e)=>m.send(JSON.stringify([o,e])),m.onmessage=o=>{e(o.target,o.data)},m.onerror=o=>{console.error("(wsock) error",o)},m.onopen=o=>{console.log("(wsock) open"),o.target.sendData("auth",{org:window.common.getOrg(),token:window.common.auth.accessToken}),t&&t(o.target)},m.onclose=o=>{console.log("(wsock) close"),n&&n(o)},m},window.module)for(let r in window.module)window.module[r].init();return console.log("(window.common) ready"),window.common}};